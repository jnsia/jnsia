FROM node:22 AS build
WORKDIR /app

# Copy root package files for monorepo
COPY package.json yarn.lock ./
COPY turbo.json ./
COPY tsconfig.base.json ./

# Copy packages
COPY packages ./packages

# Copy app
COPY apps/web/dayprint ./apps/web/dayprint

# Install dependencies at root level (for workspace)
RUN yarn install

# Build utils package first
WORKDIR /app/packages/utils
RUN yarn build

# Build the dayprint app
WORKDIR /app/apps/web/dayprint
RUN yarn build

FROM node:22-alpine
WORKDIR /app
COPY --from=build /app/apps/web/dayprint/dist /app/dist

RUN npm install -g serve

CMD ["serve", "-s", "dist", "-l", "3000"]
EXPOSE 3000
